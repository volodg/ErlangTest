
<erl>
	%request example: http://localhost:8000/test/random_deal.yaws
	out(Arg) ->
		{ Instrument, Time, Price, Amount } = random_args(),
		Response = bn_server:deal( { Instrument, Time, Price, Amount } ),
		case Response of
			{ ok, Resp } ->
				{ html, Resp };
			{ error, Descr } ->
				{ html, Descr }
		end.

	%no strong arguments validation
	current_datetime() ->
		%datetime:addSecondToDatetime( 60, { date(), time() } ).
		{ date(), time() }.

	random_instrument() ->
		%"echo23".
		lists:append( "echo", integer_to_list(random:uniform(10)) ).

	random_price() ->
		erlang:round( ( random:uniform() + 1 ) * 100 ) / 100.

	random_amount() ->
		random:uniform(1000).

	random_args() ->
		{A1,A2,A3} = now(),
		random:seed(A1, A2, A3),

		DateTime = current_datetime(),
		Instrument = random_instrument(),
		Price = random_price(),
		Amount = random_amount(),

		{ Instrument, DateTime, Price, Amount }.
</erl>
